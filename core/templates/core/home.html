{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <!-- Overlay & Background logic handles by CSS on .hero-section and .hero-overlay -->
    <div class="hero-overlay"></div>
    
    <div class="hero-content container" style="position: relative; z-index: 40;">
        <div class="pill-badge">
            UBU Traffy Fondue 2026
        </div>
        <h1 class="hero-title mb-3">
            ร่วมสร้างมหาวิทยาลัย<br class="d-none d-sm-block">ให้น่าอยู่กว่าเดิม
        </h1>
        <p class="lead text-light opacity-75 mb-4" style="max-width: 600px; margin: 0 auto;">
            ระบบแจ้งและติดตามปัญหาภายในมหาวิทยาลัยอุบลราชธานี เพื่อคุณภาพชีวิตที่ดีของนักศึกษาและบุคลากร
        </p>
        
        <a href="{% url 'create_case' %}" class="btn hero-btn text-decoration-none">
            <i class="fa-solid fa-plus me-2"></i>
            แจ้งเรื่องร้องเรียนใหม่
        </a>
    </div>
</div>

<!-- Main Content -->
<div class="container pb-5" style="margin-top: 40px; position: relative; z-index: 50;">
    
    <!-- Filter/Sort Bar (Optional, mimicking 'FilterBar') -->
    <div class="d-flex justify-content-between align-items-center mb-4 px-2">
        <h4 class="text-white fw-bold text-shadow">รายการร้องเรียนล่าสุด</h4>
        
        <div class="d-flex gap-2">
            <!-- Search Form -->
            <form action="." method="get" class="d-flex">
                <div class="input-group">
                    <span class="input-group-text bg-white border-0 rounded-start-pill ps-3">
                        <i class="fa-solid fa-search text-muted"></i>
                    </span>
                    <input type="text" name="q" class="form-control border-0 rounded-end-pill me-2" 
                           placeholder="ค้นหาตามชื่อเรื่อง..." 
                           value="{{ query|default:'' }}" 
                           style="min-width: 200px;"
                           hx-get="." 
                           hx-trigger="keyup changed delay:500ms, search" 
                           hx-target="#case-list-container" 
                           hx-push-url="true">
                </div>
                <!-- Keep sort parameter if exists -->
                {% if request.GET.sort %}
                <input type="hidden" name="sort" value="{{ request.GET.sort }}">
                {% endif %}
            </form>

            <div class="dropdown">
                <button class="btn btn-sm btn-light dropdown-toggle rounded-pill px-3 shadow-sm h-100" type="button" data-bs-toggle="dropdown">
                    เรียงตาม
                </button>
                <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-2 rounded-3">
                    <li><a class="dropdown-item rounded" href="?sort=-created_at{% if query %}&q={{ query }}{% endif %}">ใหม่สุด</a></li>
                    <li><a class="dropdown-item rounded" href="?sort=created_at{% if query %}&q={{ query }}{% endif %}">เก่าสุด</a></li>
                    <li><a class="dropdown-item rounded" href="?sort=-follower_count{% if query %}&q={{ query }}{% endif %}">ยอดนิยม</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Case Grid -->
    <div class="row g-4" id="case-list-container">
        {% include 'core/partials/case_list.html' %}
    </div>

    <div class="text-center mt-5">
        <a href="?all=true" class="btn btn-outline-light rounded-pill px-4 py-2">
            ดูรายการทั้งหมด
        </a>
    </div>
</div>
{% endblock %}